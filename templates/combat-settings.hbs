<form class="sdx-combat-settings-form">
	<div class="sdx-settings-section">
		<h3><i class="fas fa-heart-broken"></i> Damage Card Settings</h3>
		<p class="sdx-settings-hint">Configure the enhanced damage card that appears after rolling damage</p>

		<div class="sdx-setting-item">
			<div class="sdx-setting-header">
				<label for="showDamageCard">
					<input type="checkbox" name="showDamageCard" id="showDamageCard" {{checked
						settings.showDamageCard}} />
					<strong>Show Damage Card</strong>
				</label>
			</div>
			<p class="sdx-setting-hint">Display an enhanced damage card with target selection and damage application
				options</p>
		</div>

		<div class="sdx-setting-item">
			<div class="sdx-setting-header">
				<label for="showForPlayers">
					<input type="checkbox" name="showForPlayers" id="showForPlayers" {{checked
						settings.showForPlayers}} />
					<strong>Show Damage Card for Players</strong>
				</label>
			</div>
			<p class="sdx-setting-hint">If enabled, players will see the damage card. If disabled, only GMs will see it.
			</p>
		</div>

		<div class="sdx-setting-item">
			<div class="sdx-setting-header">
				<label for="scrollingCombatText">
					<input type="checkbox" name="scrollingCombatText" id="scrollingCombatText" {{checked
						settings.scrollingCombatText}} />
					<strong>{{localize "SHADOWDARK_EXTRAS.combat.scrolling_text.name"}}</strong>
				</label>
			</div>
			<p class="sdx-setting-hint">{{localize "SHADOWDARK_EXTRAS.combat.scrolling_text.hint"}}</p>
		</div>

		<div class="sdx-subsettings" data-parent="showDamageCard">
			<div class="sdx-setting-item">
				<div class="sdx-setting-header">
					<label for="showTargets">
						<input type="checkbox" name="damageCard.showTargets" id="showTargets" {{checked
							settings.damageCard.showTargets}} />
						<strong>Show Targets</strong>
					</label>
				</div>
				<p class="sdx-setting-hint">Display targeted tokens in the damage card</p>
			</div>

			<div class="sdx-setting-item">
				<div class="sdx-setting-header">
					<label for="showMultipliers">
						<input type="checkbox" name="damageCard.showMultipliers" id="showMultipliers" {{checked
							settings.damageCard.showMultipliers}} />
						<strong>Show Damage Multipliers</strong>
					</label>
				</div>
				<p class="sdx-setting-hint">Display buttons to apply damage multipliers (resistance, vulnerability,
					etc.)</p>
			</div>

			<div class="sdx-setting-item">
				<div class="sdx-setting-header">
					<label for="showApplyButton">
						<input type="checkbox" name="damageCard.showApplyButton" id="showApplyButton" {{checked
							settings.damageCard.showApplyButton}} />
						<strong>Show Apply Button</strong>
					</label>
				</div>
				<p class="sdx-setting-hint">Display a button to apply damage to targets</p>
			</div>

			<div class="sdx-setting-item">
				<div class="sdx-setting-header">
					<label for="autoApplyDamage">
						<input type="checkbox" name="damageCard.autoApplyDamage" id="autoApplyDamage" {{checked
							settings.damageCard.autoApplyDamage}} />
						<strong>Auto-Apply Damage</strong>
					</label>
				</div>
				<p class="sdx-setting-hint">Automatically apply damage to targets when a successful attack is rolled</p>
			</div>

			<div class="sdx-setting-item">
				<div class="sdx-setting-header">
					<label for="autoApplyConditions">
						<input type="checkbox" name="damageCard.autoApplyConditions" id="autoApplyConditions" {{checked
							settings.damageCard.autoApplyConditions}} />
						<strong>Auto-Apply Conditions</strong>
					</label>
				</div>
				<p class="sdx-setting-hint">Automatically apply conditions/effects to targets when a successful spell is
					cast</p>
			</div>

			<div class="sdx-setting-item">
				<h4>Damage Multipliers</h4>
				<p class="sdx-setting-hint">Configure which damage multiplier buttons appear on the card</p>
				<div class="sdx-multiplier-config">
					{{#each settings.damageCard.damageMultipliers}}
					<div class="sdx-multiplier-item">
						<input type="checkbox" name="damageCard.damageMultipliers.{{@index}}.enabled"
							id="mult-{{@index}}" {{checked this.enabled}} />
						<label for="mult-{{@index}}">
							<span class="sdx-mult-label">{{this.label}}</span>
							<span class="sdx-mult-value">({{this.value}}Ã—)</span>
						</label>
						<input type="hidden" name="damageCard.damageMultipliers.{{@index}}.value"
							value="{{this.value}}" />
						<input type="hidden" name="damageCard.damageMultipliers.{{@index}}.label"
							value="{{this.label}}" />
					</div>
					{{/each}}
				</div>
			</div>
		</div>
	</div>

	<footer class="sheet-footer flexrow">
		<button type="submit" name="submit">
			<i class="fas fa-save"></i> Save Settings
		</button>
		<button type="button" name="reset">
			<i class="fas fa-undo"></i> Reset to Defaults
		</button>
	</footer>
</form>

<script>
	// Toggle subsettings visibility based on parent checkbox
	const parentCheckbox = document.getElementById('showDamageCard');
	const subsettings = document.querySelector('[data-parent="showDamageCard"]');

	function toggleSubsettings() {
		if (subsettings) {
			subsettings.style.opacity = parentCheckbox.checked ? '1' : '0.5';
			subsettings.style.pointerEvents = parentCheckbox.checked ? 'auto' : 'none';
		}
	}

	if (parentCheckbox && subsettings) {
		parentCheckbox.addEventListener('change', toggleSubsettings);
		toggleSubsettings();
	}
</script>